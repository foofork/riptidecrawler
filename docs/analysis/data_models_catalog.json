{
  "analysis_metadata": {
    "generated_at": "2025-11-03",
    "analyzer": "Data Models Specialist",
    "codebase": "EventMesh (RipTide)",
    "total_structs_found": "200+",
    "total_enums_found": "60+",
    "primary_model_files": 14
  },

  "storage_mechanisms": {
    "redis_cache": {
      "implementation": "Redis/DragonflyDB",
      "primary_crates": ["riptide-cache", "riptide-persistence"],
      "key_structures": [
        "CacheManager",
        "RedisCacheManager",
        "PersistentCacheManager",
        "DistributedCache"
      ],
      "configuration": {
        "default_url": "redis://localhost:6379",
        "pool_size": 10,
        "ttl_default": "24 hours",
        "compression": "lz4",
        "eviction_policy": "LRU"
      },
      "use_cases": [
        "HTTP response caching",
        "WASM module caching",
        "AOT compilation cache",
        "Session state persistence",
        "Distributed coordination"
      ]
    },

    "file_storage": {
      "implementation": "Filesystem-based",
      "locations": [
        "Artifacts storage",
        "Cache spillover",
        "State checkpoints",
        "WASM module cache"
      ],
      "key_structures": [
        "FileStorage",
        "DatabaseStorage",
        "StorageBackend"
      ]
    },

    "in_memory": {
      "implementation": "In-process memory",
      "structures": [
        "StratifiedInstancePool",
        "MemoryManager",
        "FrontierManager",
        "EventBus"
      ],
      "use_cases": [
        "WASM instance pooling",
        "URL frontier queues",
        "Event routing",
        "Real-time metrics"
      ]
    }
  },

  "core_domain_models": {
    "extraction": {
      "crate": "riptide-extraction",
      "primary_types": [
        {
          "name": "ExtractedDoc",
          "purpose": "Extracted document content",
          "serializable": true,
          "storage": "redis_cache",
          "schema_coupling": "high"
        },
        {
          "name": "ExtractionRequest",
          "purpose": "Extraction operation request",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "medium"
        },
        {
          "name": "Chunk",
          "purpose": "Content chunking result",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "low"
        },
        {
          "name": "ChunkingConfig",
          "purpose": "Chunking configuration",
          "serializable": true,
          "storage": "configuration",
          "schema_coupling": "low"
        }
      ]
    },

    "spider": {
      "crate": "riptide-spider",
      "primary_types": [
        {
          "name": "Spider",
          "purpose": "Main spider coordinator",
          "serializable": false,
          "storage": "in_memory",
          "schema_coupling": "medium"
        },
        {
          "name": "CrawlRequest",
          "purpose": "Crawl operation request",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "high"
        },
        {
          "name": "CrawlResult",
          "purpose": "Crawl operation result",
          "serializable": true,
          "storage": "redis_cache",
          "schema_coupling": "high"
        },
        {
          "name": "SpiderConfig",
          "purpose": "Spider configuration",
          "serializable": true,
          "storage": "configuration",
          "schema_coupling": "medium"
        },
        {
          "name": "FrontierManager",
          "purpose": "URL frontier management",
          "serializable": false,
          "storage": "in_memory",
          "schema_coupling": "medium"
        }
      ]
    },

    "events": {
      "crate": "riptide-events",
      "primary_types": [
        {
          "name": "EventBus",
          "purpose": "Event distribution hub",
          "serializable": false,
          "storage": "in_memory",
          "schema_coupling": "low"
        },
        {
          "name": "PoolEvent",
          "purpose": "Pool operation events",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "high",
          "event_domain": "pool"
        },
        {
          "name": "ExtractionEvent",
          "purpose": "Extraction operation events",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "high",
          "event_domain": "extraction"
        },
        {
          "name": "CrawlEvent",
          "purpose": "Crawl operation events",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "high",
          "event_domain": "crawl"
        },
        {
          "name": "HealthEvent",
          "purpose": "Health check events",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "medium",
          "event_domain": "health"
        },
        {
          "name": "MetricsEvent",
          "purpose": "Performance metrics events",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "medium",
          "event_domain": "metrics"
        }
      ]
    },

    "pool": {
      "crate": "riptide-pool",
      "primary_types": [
        {
          "name": "PooledInstance",
          "purpose": "WASM instance wrapper",
          "serializable": false,
          "storage": "in_memory",
          "schema_coupling": "medium"
        },
        {
          "name": "CircuitBreakerState",
          "purpose": "Error handling state machine",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "low"
        },
        {
          "name": "MemoryStats",
          "purpose": "Memory usage tracking",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "low"
        }
      ]
    },

    "persistence": {
      "crate": "riptide-persistence",
      "primary_types": [
        {
          "name": "PersistenceConfig",
          "purpose": "Persistence configuration",
          "serializable": true,
          "storage": "configuration",
          "schema_coupling": "low"
        },
        {
          "name": "RedisConfig",
          "purpose": "Redis connection config",
          "serializable": true,
          "storage": "configuration",
          "schema_coupling": "low"
        },
        {
          "name": "CacheConfig",
          "purpose": "Cache behavior config",
          "serializable": true,
          "storage": "configuration",
          "schema_coupling": "low"
        },
        {
          "name": "SessionState",
          "purpose": "Session state tracking",
          "serializable": true,
          "storage": "redis_cache",
          "schema_coupling": "medium"
        },
        {
          "name": "TenantConfig",
          "purpose": "Multi-tenancy config",
          "serializable": true,
          "storage": "configuration",
          "schema_coupling": "medium"
        }
      ]
    },

    "api": {
      "crate": "riptide-api",
      "primary_types": [
        {
          "name": "CrawlBody",
          "purpose": "API request body",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "high"
        },
        {
          "name": "CrawlResponse",
          "purpose": "API response body",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "high"
        },
        {
          "name": "HealthResponse",
          "purpose": "Health check response",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "medium"
        },
        {
          "name": "DeepSearchBody",
          "purpose": "Search API request",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "high"
        },
        {
          "name": "SearchResult",
          "purpose": "Search result item",
          "serializable": true,
          "storage": "redis_cache",
          "schema_coupling": "high"
        }
      ]
    },

    "security": {
      "crate": "riptide-security",
      "primary_types": [
        {
          "name": "SecurityContext",
          "purpose": "Request security context",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "medium"
        },
        {
          "name": "ApiKey",
          "purpose": "API key model",
          "serializable": true,
          "storage": "redis_cache",
          "schema_coupling": "high"
        },
        {
          "name": "BudgetManager",
          "purpose": "Cost tracking",
          "serializable": false,
          "storage": "redis_cache",
          "schema_coupling": "medium"
        },
        {
          "name": "PiiRedactor",
          "purpose": "PII detection/redaction",
          "serializable": false,
          "storage": "in_memory",
          "schema_coupling": "low"
        },
        {
          "name": "AuditLogEntry",
          "purpose": "Security audit log",
          "serializable": true,
          "storage": "redis_cache",
          "schema_coupling": "medium"
        }
      ]
    },

    "stealth": {
      "crate": "riptide-stealth",
      "primary_types": [
        {
          "name": "StealthConfig",
          "purpose": "Anti-detection configuration",
          "serializable": true,
          "storage": "configuration",
          "schema_coupling": "medium"
        },
        {
          "name": "BrowserFingerprint",
          "purpose": "Browser fingerprint data",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "high"
        },
        {
          "name": "UserAgentManager",
          "purpose": "User agent rotation",
          "serializable": false,
          "storage": "in_memory",
          "schema_coupling": "low"
        },
        {
          "name": "DetectionScore",
          "purpose": "Detection risk scoring",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "medium"
        }
      ]
    },

    "monitoring": {
      "crate": "riptide-monitoring",
      "primary_types": [
        {
          "name": "PerformanceMetrics",
          "purpose": "Performance tracking",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "low"
        },
        {
          "name": "MetricsCollector",
          "purpose": "Metrics aggregation",
          "serializable": false,
          "storage": "in_memory",
          "schema_coupling": "low"
        },
        {
          "name": "Alert",
          "purpose": "Alert definition",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "low"
        },
        {
          "name": "HealthThresholds",
          "purpose": "Health check thresholds",
          "serializable": true,
          "storage": "configuration",
          "schema_coupling": "low"
        },
        {
          "name": "ValidationReport",
          "purpose": "System validation report",
          "serializable": true,
          "storage": "in_memory",
          "schema_coupling": "medium"
        }
      ]
    }
  },

  "configuration_models": {
    "description": "Configuration structures (80+ found)",
    "patterns": [
      "Centralized config structs ending in 'Config'",
      "Builder pattern for complex configs",
      "Environment variable override support",
      "Serde serialization for YAML/JSON/TOML"
    ],
    "key_configs": [
      "SpiderConfig",
      "StealthConfig",
      "SecurityConfig",
      "PersistenceConfig",
      "MonitoringConfig",
      "SearchConfig",
      "BudgetConfig",
      "SessionConfig"
    ]
  },

  "serialization_patterns": {
    "serde_usage": {
      "derive_macros": ["Serialize", "Deserialize", "Debug", "Clone"],
      "common_pattern": "#[derive(Serialize, Deserialize, Debug, Clone)]",
      "coverage": "95%+ of data models"
    },
    "formats": [
      "JSON (primary)",
      "YAML (configuration)",
      "TOML (configuration)",
      "NDJSON (streaming)",
      "Binary (Redis)"
    ]
  },

  "schema_coupling_analysis": {
    "high_coupling": {
      "description": "Tightly coupled to event/extraction domain",
      "types": [
        "PoolEvent",
        "ExtractionEvent",
        "CrawlEvent",
        "CrawlRequest",
        "CrawlResult",
        "ExtractedDoc",
        "ApiKey",
        "BrowserFingerprint"
      ],
      "impact": "Schema changes require coordinated updates",
      "recommendation": "Consider versioned schemas"
    },

    "medium_coupling": {
      "description": "Some domain-specific logic",
      "types": [
        "HealthEvent",
        "MetricsEvent",
        "SecurityContext",
        "SessionState",
        "DetectionScore"
      ],
      "impact": "Moderate refactoring required",
      "recommendation": "Abstract domain logic where possible"
    },

    "low_coupling": {
      "description": "Generic/reusable structures",
      "types": [
        "PerformanceMetrics",
        "Alert",
        "CircuitBreakerState",
        "Config structures",
        "Chunk",
        "MemoryStats"
      ],
      "impact": "Minimal coupling, easily refactored",
      "recommendation": "Good candidates for extraction to shared crates"
    }
  },

  "event_system_analysis": {
    "architecture": "Event-driven with central bus",
    "event_types": [
      {
        "type": "PoolEvent",
        "operations": [
          "InstanceCreated",
          "InstanceAcquired",
          "InstanceReleased",
          "InstanceFailed",
          "InstanceUnhealthy",
          "PoolExhausted",
          "MemoryCleanup"
        ]
      },
      {
        "type": "ExtractionEvent",
        "operations": [
          "Started",
          "Completed",
          "Failed",
          "Timeout",
          "FallbackUsed"
        ]
      },
      {
        "type": "CrawlEvent",
        "operations": [
          "Started",
          "Completed",
          "Failed",
          "Timeout",
          "AiEnhancementFailed"
        ]
      },
      {
        "type": "HealthEvent",
        "states": [
          "Healthy",
          "Degraded",
          "Unhealthy",
          "Critical"
        ]
      },
      {
        "type": "MetricsEvent",
        "categories": [
          "Performance",
          "Memory",
          "Cache",
          "Pool"
        ]
      }
    ],
    "routing": [
      "Broadcast (all handlers)",
      "PatternBased (event type patterns)",
      "SeverityBased (severity levels)",
      "Custom"
    ],
    "handlers": [
      "LoggingEventHandler",
      "MetricsEventHandler",
      "TelemetryEventHandler",
      "HealthEventHandler"
    ]
  },

  "redis_data_patterns": {
    "key_structure": "prefix:version:namespace:key",
    "example_keys": [
      "riptide:v1:cache:{url_hash}",
      "riptide:v1:session:{session_id}",
      "riptide:v1:state:{crawl_id}",
      "riptide:v1:wasm:{module_hash}",
      "riptide:v1:tenant:{tenant_id}"
    ],
    "data_types": [
      "String (JSON serialized)",
      "Hash (structured data)",
      "Set (URL sets)",
      "ZSet (priority queues)",
      "List (message queues)"
    ],
    "ttl_strategy": {
      "default": "24 hours",
      "sessions": "configurable",
      "cache": "HTTP cache-control",
      "temporary": "1 hour"
    }
  },

  "key_findings": [
    "200+ data structures with comprehensive serialization",
    "60+ enums for state machines and type safety",
    "Redis as primary distributed storage (DragonflyDB compatible)",
    "Event-driven architecture with 5 major event types",
    "High schema coupling in event/extraction domains",
    "Strong separation of concerns via crate boundaries",
    "Configuration-driven with builder patterns",
    "Multi-tenant support with isolation levels",
    "WASM instance pooling with sophisticated memory management",
    "Circuit breaker patterns for resilience"
  ],

  "decoupling_recommendations": [
    {
      "priority": "high",
      "area": "Event schemas",
      "issue": "Event types tightly coupled to domain logic",
      "recommendation": "Introduce versioned event schemas with adapters",
      "affected_crates": ["riptide-events", "riptide-pool", "riptide-extraction"]
    },
    {
      "priority": "high",
      "area": "API models",
      "issue": "Request/response types expose internal structures",
      "recommendation": "Add DTOs layer between API and domain models",
      "affected_crates": ["riptide-api", "riptide-types"]
    },
    {
      "priority": "medium",
      "area": "Configuration",
      "issue": "Config structs scattered across crates",
      "recommendation": "Centralize config in riptide-config crate",
      "affected_crates": ["all"]
    },
    {
      "priority": "medium",
      "area": "Storage abstraction",
      "issue": "Redis details leak into domain models",
      "recommendation": "Introduce repository pattern with trait abstraction",
      "affected_crates": ["riptide-persistence", "riptide-cache"]
    },
    {
      "priority": "low",
      "area": "Metrics types",
      "issue": "Metrics structures duplicated across crates",
      "recommendation": "Extract common metrics to shared crate",
      "affected_crates": ["riptide-monitoring", "riptide-performance"]
    }
  ],

  "migration_complexity": {
    "event_system": "high - central to architecture",
    "persistence_layer": "medium - well abstracted",
    "api_contracts": "medium - versioning needed",
    "configuration": "low - already serializable",
    "monitoring": "low - loosely coupled"
  }
}
