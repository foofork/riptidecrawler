# Riptide Crate Dependencies - ASCII Tree Diagram
# Generated: 2025-11-03
# Total Crates: 26 workspace members

================================================================================
LEGEND:
  ‚Üí Internal workspace dependency
  ‚ö° External critical dependency
  üîÑ Circular dependency (RESOLVED via abstraction)
  üì¶ Leaf crate (no internal dependencies)
  üå≥ Root crate (many dependents)
  üîó Highly coupled crate
================================================================================

## FOUNDATION LAYER (No internal dependencies - Pure Leaf Crates)
================================================================================

üì¶ riptide-types
   Description: Shared types, traits, and error definitions
   Internal Deps: NONE
   External Deps:
     ‚ö° serde, serde_json - Serialization
     ‚ö° tokio - Async runtime
     ‚ö° thiserror, anyhow - Error handling
     ‚ö° chrono, uuid, url - Utilities
   Dependents: 24 crates (MOST DEPENDED ON - Foundation for everything)

üì¶ riptide-config
   Description: Configuration management
   Internal Deps: riptide-types
   External Deps:
     ‚ö° serde, serde_json
     ‚ö° regex, url, once_cell
   Dependents: 3 crates (spider, fetch, api)

üì¶ riptide-stealth
   Description: Anti-detection for browser automation
   Internal Deps: NONE
   External Deps:
     ‚ö° serde, serde_json
     ‚ö° rand, dashmap
   Dependents: 4 crates (browser, headless, facade, api)

üì¶ riptide-test-utils
   Description: Testing utilities
   Internal Deps: NONE
   External Deps:
     ‚ö° tokio, serde, tempfile
     ‚ö° axum, tower (optional)
   Dependents: 0 (dev dependency only)

================================================================================
## CORE INFRASTRUCTURE LAYER
================================================================================

üå≥ riptide-monitoring
   Description: Telemetry, metrics, observability
   Internal Deps: riptide-types
   External Deps:
     ‚ö° opentelemetry, opentelemetry-otlp - Telemetry
     ‚ö° sysinfo, psutil - System monitoring
     ‚ö° prometheus (optional)
     ‚ö° hdrhistogram - Performance metrics
   Dependents: 4 crates (events, reliability, api, facade)

üå≥ riptide-fetch
   Description: HTTP/network layer
   Internal Deps:
     ‚Üí riptide-types
     ‚Üí riptide-config
   External Deps:
     ‚ö° reqwest - HTTP client
     ‚ö° hyper, http, bytes
     ‚ö° opentelemetry - Telemetry
     ‚ö° robotstxt, xml
   Dependents: 4 crates (spider, reliability, facade, api)

üîó riptide-events
   Description: Event bus and messaging
   Internal Deps:
     ‚Üí riptide-types
     ‚Üí riptide-monitoring
   External Deps:
     ‚ö° tokio, futures
     ‚ö° opentelemetry
   Dependents: 7 crates (pool, cache, reliability, intelligence, workers, search, api)

================================================================================
## BROWSER AUTOMATION LAYER
================================================================================

riptide-browser-abstraction
   Description: Browser abstraction layer
   Internal Deps: riptide-types
   External Deps:
     ‚ö° spider_chrome - High-performance CDP
     ‚ö° spider_chromiumoxide_cdp - CDP types
   Dependents: 1 crate (browser)

riptide-browser
   Description: Browser pool management and launcher
   Internal Deps:
     ‚Üí riptide-browser-abstraction
     ‚Üí riptide-stealth
   External Deps:
     ‚ö° spider_chrome
     ‚ö° spider_chromiumoxide_cdp
     ‚ö° tempfile
   Dependents: 3 crates (headless, facade, api)

riptide-headless
   Description: Headless browser API endpoints
   Internal Deps:
     ‚Üí riptide-browser
     ‚Üí riptide-stealth
   External Deps:
     ‚ö° axum - Web framework
     ‚ö° spider_chrome
   Dependents: 1 crate (api)

================================================================================
## EXTRACTION & PROCESSING LAYER
================================================================================

üîó riptide-extraction
   Description: HTML processing and content extraction
   Internal Deps: riptide-types
   External Deps:
     ‚ö° scraper - CSS selector engine
     ‚ö° lol_html - Streaming HTML parser
     ‚ö° regex - Pattern matching
     ‚ö° wasmtime, wasmtime-wasi (optional) - WASM execution
     ‚ö° tiktoken-rs - Token counting
   Features:
     - native-parser (default)
     - wasm-extractor (opt-in)
   Dependents: 9 crates (HIGH COUPLING)

riptide-pdf
   Description: PDF processing
   Internal Deps: riptide-types
   External Deps:
     ‚ö° pdfium-render - PDF rendering
     ‚ö° lopdf - PDF parsing
   Dependents: 3 crates (facade, workers, api)

riptide-pool
   Description: Instance pooling for extractors
   Internal Deps:
     ‚Üí riptide-types
     ‚Üí riptide-events
     ‚Üí riptide-extraction (optional)
   External Deps:
     ‚ö° wasmtime (optional)
     ‚ö° scraper
   Features:
     - native-pool (default)
     - wasm-pool (opt-in)
   Dependents: 2 crates (cache, reliability)

================================================================================
## SPIDER & CRAWLING LAYER
================================================================================

üîó riptide-spider
   Description: Web crawler/spider engine
   Internal Deps:
     ‚Üí riptide-types
     ‚Üí riptide-config
     ‚Üí riptide-fetch
   External Deps:
     ‚ö° spider - Spider library
     ‚ö° robotstxt - robots.txt parser
     ‚ö° xml - Sitemap parsing
     ‚ö° wasmtime - WASM execution
     ‚ö° sysinfo, psutil - Resource monitoring
   Dependents: 2 crates (facade, api)

================================================================================
## RELIABILITY & CACHING LAYER
================================================================================

üîÑ riptide-reliability (Circular Dependency RESOLVED)
   Description: Circuit breakers, retry patterns, fault tolerance
   Internal Deps:
     ‚Üí riptide-types
     ‚Üí riptide-fetch
     ‚Üí riptide-events (optional)
     ‚Üí riptide-monitoring (optional)
     ‚Üí riptide-pool (optional)
   Resolution: Uses HtmlParser trait abstraction from riptide-types
   External Deps:
     ‚ö° reqwest, uuid
   Dependents: 3 crates (intelligence, workers, api)

riptide-cache
   Description: Cache management system
   Internal Deps:
     ‚Üí riptide-types
     ‚Üí riptide-pool
     ‚Üí riptide-events
     ‚Üí riptide-extraction
   External Deps:
     ‚ö° redis - Distributed caching
     ‚ö° sha2 - Cache key hashing
     ‚ö° dashmap - Concurrent hashmap
   Features:
     - distributed, warming
     - wasm-pool, wasm-extractor (opt-in)
   Dependents: 3 crates (facade, workers, api)

riptide-persistence
   Description: Advanced persistence with Redis/DragonflyDB
   Internal Deps: NONE (standalone)
   External Deps:
     ‚ö° redis - Primary backend
     ‚ö° blake3, sha2 - Hashing
     ‚ö° lz4_flex, zstd (optional) - Compression
   Dependents: 1 crate (api)

================================================================================
## INTELLIGENCE & SEARCH LAYER
================================================================================

riptide-intelligence
   Description: LLM abstraction layer
   Internal Deps:
     ‚Üí riptide-reliability
     ‚Üí riptide-types
     ‚Üí riptide-events
   External Deps:
     ‚ö° reqwest - HTTP client for providers
     ‚ö° tiktoken-rs - Token counting
     ‚ö° dashmap, arc-swap
   Features: openai, anthropic, groq
   Dependents: 1 crate (api)

riptide-search
   Description: Search provider abstraction
   Internal Deps: NONE
   External Deps:
     ‚ö° reqwest - HTTP client
     ‚ö° regex, url
   Dependents: 2 crates (facade, api)

================================================================================
## SECURITY & MONITORING LAYER
================================================================================

riptide-security
   Description: Security middleware and PII handling
   Internal Deps: riptide-types
   External Deps:
     ‚ö° sha2, base64, hex - Cryptography
     ‚ö° governor - Rate limiting
   Features: api-keys, audit, budget, middleware, pii
   Dependents: 0 (used via API)

riptide-performance
   Description: Performance monitoring and profiling
   Internal Deps: NONE
   External Deps:
     ‚ö° tikv-jemalloc-ctl - Memory profiling
     ‚ö° pprof - Profiling
     ‚ö° tokio-metrics - Runtime metrics
     ‚ö° opentelemetry
   Features: jemalloc, memory-profiling, bottleneck-analysis
   Dependents: 1 crate (api)

================================================================================
## HIGH-LEVEL API LAYER
================================================================================

üîó riptide-facade
   Description: High-level unified API
   Internal Deps:
     ‚Üí riptide-types
     ‚Üí riptide-fetch
     ‚Üí riptide-extraction
     ‚Üí riptide-pdf
     ‚Üí riptide-cache
     ‚Üí riptide-browser
     ‚Üí riptide-stealth
     ‚Üí riptide-monitoring (optional)
     ‚Üí riptide-spider
     ‚Üí riptide-search
   External Deps:
     ‚ö° scraper
     ‚ö° spider_chromiumoxide_cdp
   Dependents: 1 crate (api)

üå≥ riptide-api (Root Service - Highest Complexity)
   Description: REST API server (main application)
   Internal Deps (16 total - HIGHEST):
     ‚Üí riptide-types
     ‚Üí riptide-spider
     ‚Üí riptide-fetch
     ‚Üí riptide-security (not shown in current deps, should be added)
     ‚Üí riptide-monitoring
     ‚Üí riptide-events
     ‚Üí riptide-pool (via extraction)
     ‚Üí riptide-extraction
     ‚Üí riptide-search
     ‚Üí riptide-config
     ‚Üí riptide-intelligence
     ‚Üí riptide-workers
     ‚Üí riptide-browser
     ‚Üí riptide-headless
     ‚Üí riptide-performance
     ‚Üí riptide-persistence
     ‚Üí riptide-monitoring
     ‚Üí riptide-facade
     ‚Üí riptide-pdf
     ‚Üí riptide-stealth
     ‚Üí riptide-cache
     ‚Üí riptide-reliability
   External Deps:
     ‚ö° axum - Web framework
     ‚ö° redis - Job queue
     ‚ö° wasmtime - WASM execution
     ‚ö° prometheus - Metrics
   Dependents: NONE (top-level application)

üì¶ riptide-cli (Thin Client)
   Description: Command-line interface (API client)
   Internal Deps: NONE (Phase 1 thin CLI - all logic in API)
   External Deps:
     ‚ö° clap - CLI parsing
     ‚ö° reqwest - HTTP client
     ‚ö° colored, indicatif, comfy-table - UI
   Dependents: NONE (standalone binary)

riptide-workers
   Description: Background job processing
   Internal Deps:
     ‚Üí riptide-types
     ‚Üí riptide-reliability
     ‚Üí riptide-extraction
     ‚Üí riptide-cache
     ‚Üí riptide-pdf
   External Deps:
     ‚ö° redis - Job queue
     ‚ö° cron - Scheduling
   Dependents: 1 crate (api)

riptide-streaming
   Description: SSE/WebSocket streaming
   Internal Deps: riptide-extraction
   External Deps:
     ‚ö° axum - WebSocket support
     ‚ö° tokio-stream
     ‚ö° async-stream
   Dependents: 0 (used via API)

================================================================================
## DEPENDENCY STATISTICS
================================================================================

MOST DEPENDED ON (Foundation crates):
  1. riptide-types: 24 dependents
  2. riptide-events: 7 dependents
  3. riptide-monitoring: 4 dependents
  4. riptide-fetch: 4 dependents
  5. riptide-extraction: 9 dependents (high coupling concern)

MOST DEPENDENCIES (Complex crates):
  1. riptide-api: 16+ internal dependencies
  2. riptide-facade: 10 internal dependencies
  3. riptide-reliability: 5 internal dependencies
  4. riptide-cache: 4 internal dependencies

LEAF CRATES (No internal dependencies):
  - riptide-types (foundation)
  - riptide-stealth
  - riptide-test-utils
  - riptide-persistence
  - riptide-search
  - riptide-performance
  - riptide-security
  - riptide-cli (thin client)

CRITICAL EXTERNAL DEPENDENCIES:
  ‚ö° tokio - Async runtime (26/26 crates)
  ‚ö° serde/serde_json - Serialization (26/26 crates)
  ‚ö° reqwest - HTTP client (10 crates)
  ‚ö° spider_chrome/spider_chromiumoxide_cdp - Browser automation (5 crates)
  ‚ö° redis - Caching/job queue (4 crates)
  ‚ö° axum - Web framework (5 crates)
  ‚ö° wasmtime - WASM execution (5 crates)
  ‚ö° opentelemetry - Observability (5 crates)

CIRCULAR DEPENDENCIES:
  ‚úÖ RESOLVED: riptide-reliability ‚Üê‚Üí riptide-extraction
     - Resolution: HtmlParser trait abstraction in riptide-types
     - Reliability uses trait, extraction implements it

OVERLAPPING FUNCTIONALITY:
  - Browser automation: riptide-browser + riptide-browser-abstraction + riptide-headless
    ‚Üí Could consolidate into single crate
  - Caching: riptide-cache + riptide-persistence
    ‚Üí Different use cases but some overlap

ARCHITECTURAL RECOMMENDATIONS:
  1. ‚úÖ Good separation: Foundation layer (types, config, stealth) is clean
  2. ‚úÖ Good abstraction: Circular dependency resolved via traits
  3. ‚ö†Ô∏è  High coupling: riptide-extraction used by 9 crates
  4. ‚ö†Ô∏è  API complexity: riptide-api depends on 16+ crates
  5. ‚úÖ Thin CLI: riptide-cli properly separated from business logic
  6. ‚ö†Ô∏è  Browser crates: Consider consolidating 3 browser crates
  7. ‚úÖ WASM optional: Good feature flags for opt-in WASM usage

================================================================================
